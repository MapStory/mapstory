!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),(t.storytools||(t.storytools={})).mapstory=e()}}(function(){return function e(t,o,r){function i(n,p){if(!o[n]){if(!t[n]){var s="function"==typeof require&&require;if(!p&&s)return s(n,!0);if(a)return a(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var f=o[n]={exports:{}};t[n][0].call(f.exports,function(e){var o=t[n][1][e];return i(o?o:e)},f,f.exports,e,t,o,r)}return o[n].exports}for(var a="function"==typeof require&&require,n=0;n<r.length;n++)i(r[n]);return i}({1:[function(e,t,o){o.MapConfigTransformer=e("./MapConfigTransformer")},{"./MapConfigTransformer":2}],2:[function(e,t,o){o.MapConfigTransformer=function(e){var t,o,r=[],i="instant";if(e.tools)for(t=0,o=e.tools.length;o>t;++t){var a=e.tools[t];"gxp_playback"===a.ptype&&a.outputConfig&&"cumulative"===a.outputConfig.playbackMode&&(i="cumulative")}for(t=0,o=e.map.layers.length;o>t;++t){var n=e.map.layers[t];if(n.visibility===!0){var p=e.sources[n.source],s={visibility:n.visibility,group:n.group};if("gxp_mapquestsource"===p.ptype)s.type="MapQuest",s.layer="naip"===n.name?"sat":"osm",s.title=n.title,r.push(s);else if("gxp_mapboxsource"===p.ptype)s.type="MapBox",s.name=n.name,s.title=n.title,r.push(s);else if("gx_olsource"===p.ptype||"gxp_wmscsource"===p.ptype){if(s.type="gx_olsource"===p.ptype?n.type.replace("OpenLayers.Layer.",""):"WMS","OSM"===s.type)s.args&&"Humanitarian OpenStreetMap"===s.args[0]&&(s.type="HOT"),s.title=n.title;else if("WMS"===s.type){var l;if("gx_olsource"===p.ptype){l=n.args[2]||{};for(var f in l)l[f].constructor===Array&&(l[f.toUpperCase()]=l[f].join(","),delete l[f]);s.url=n.args[1]}else l={LAYERS:n.name,STYLES:n.styles,TILED:"TRUE",FORMAT:n.format,TRANSPARENT:n.transparent},n.tiled===!1&&(s.singleTile=!0),s.id=n.name,s.name=n.name,s.title=n.title,s.url=void 0!==p.url?p.url.replace("http://mapstory.org/geoserver/","/geoserver/"):"/geoserver/";if(s.params=l,s.params.VERSION="1.1.1",n.capability){s.latlonBBOX=n.capability.llbbox;var u=storytools.core.time.maps.readCapabilitiesTimeDimensions(n.capability,!0);if(void 0!==u&&(s.times=u),n.capability.tileSets){for(var y in n.capability.tileSets[0].bbox){var c=n.capability.tileSets[0].bbox[y].bbox;s.bbox=c}s.resolutions=n.capability.tileSets[0].resolutions}}}r.push(s)}else window.console&&window.console.warn("Unknown source type in map config: "+p.ptype)}}return{id:e.id,playbackMode:i,map:{center:e.map.center,projection:e.map.projection,zoom:e.map.zoom,layers:r}}}},{}]},{},[1])(1)});